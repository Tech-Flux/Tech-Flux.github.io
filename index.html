<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music | Player</title>
    <script src="https://www.youtube.com/iframe_api"></script> <!-- YouTube API -->
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f4f4f4;
        }
        #searchBox {
            padding: 10px;
            width: 80%;
            max-width: 400px;
            margin: 10px;
        }
        .song {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            border: 1px solid #ddd;
            margin: 5px auto;
            width: 80%;
            max-width: 500px;
            border-radius: 5px;
            background: #fff;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1);
        }
        img {
            width: 50px;
            height: 50px;
            border-radius: 5px;
        }
        button {
            padding: 5px 10px;
            cursor: pointer;
            border: none;
            background: #28a745;
            color: white;
            border-radius: 5px;
        }
        button:hover {
            background: #218838;
        }
        .play-btn {
            background: #007bff;
        }
        .play-btn:hover {
            background: #0056b3;
        }
        #player {
            display: none; /* Hide video player */
            width: 0;
            height: 0;
        }

        footer{
            margin: 0;
            border-radius: 10px;
        }
    </style>
</head>
<body>

    <h1>Music Player | Poison</h1>
    <input type="text" id="searchBox" placeholder="Search for a song or artist...">
    <button onclick="searchMusic()">Search</button>
    
    <div id="results"></div>

    <div id="player"></div> <!-- hidden player-->
<!-- 
    <footer>
        <p>Enjoy your music! Stay connected:</p>
        <div class="social-icons">
            <a href="https://wa.me/" target="_blank">&#x1F4AC;</a>
            <a href="https://t.me/" target="_blank">&#x1F426;</a>
            <a href="https://github.com/" target="_blank">&#x1F5C3;</a>
            <a href="https://twitter.com/" target="_blank">&#x1F426;</a>
        </div>
    </footer> -->

    <script>
        let apiKey = "AIzaSyAbiMR7LjCpEIsQoXRnFcLs45piQZxhEkQ"; 
        let player;
        let currentVideoId = "";
        let apiReady = false;
    
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                height: '0',
                width: '0',
                videoId: '',
                playerVars: {
                    autoplay: 1,
                    controls: 0,
                    showinfo: 0,
                    modestbranding: 1
                },
                events: {
                    'onStateChange': onPlayerStateChange
                }
            });
            apiReady = true; 
        }
    
        async function searchMusic() {
            let query = document.getElementById('searchBox').value;
            if (!query) {
                alert('Please enter a song or artist name');
                return;
            }
    
            let url = `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&q=${encodeURIComponent(query)}+music&videoCategoryId=10&key=${apiKey}`;
            let response = await fetch(url);
            let data = await response.json();
            
            let resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';
    
            if (!data.items || data.items.length === 0) {
                resultsDiv.innerHTML = '<p>No results found. Try another search.</p>';
                return;
            }
    
            data.items.forEach(video => {
                let videoId = video.id.videoId;
                let title = video.snippet.title;
                let thumbnail = video.snippet.thumbnails.default.url;
    
                let songDiv = document.createElement('div');
                songDiv.className = 'song';
    
                songDiv.innerHTML = `
                    <img src="${thumbnail}" alt="Thumbnail">
                    <div><strong>${title}</strong></div>
                    <button class="play-btn" onclick="playAudio('${videoId}', this)">▶ Play</button>
                `;
                resultsDiv.appendChild(songDiv);
            });
        }

        
    
    function playAudio(videoId, button) {
    if (!apiReady || !player) {
        alert("Player not ready! Please wait a few seconds and try again.");
        return;
    }

    if (currentVideoId === videoId && player.getPlayerState() === 1) {
        player.pauseVideo();
        button.innerText = "▶ Play";
    } else {
        player.loadVideoById(videoId);
        player.playVideo();
        player.unMute(); // 🔊 
        currentVideoId = videoId;
        updateButtons(button);
    }
}

    
        function updateButtons(activeButton) {
            document.querySelectorAll('.play-btn').forEach(button => {
                button.innerText = "▶ Play";
            });
            activeButton.innerText = "⏸ Pause";
        }
    
        function onPlayerStateChange(event) {
            if (event.data === 0) {
                document.querySelectorAll('.play-btn').forEach(button => {
                    button.innerText = "▶ Play";
                });
            }
        }

        function onPlayerStateChange(event) {
        if (event.data === 0) { 
            sessionStorage.removeItem("currentVideoId");
            document.querySelectorAll('.play-btn').forEach(button => {
                button.innerText = "▶ Play";
            });
        }
    }

    // Prevent reload chutya
    window.addEventListener("beforeunload", function(event) {
        if (currentVideoId) {
            event.preventDefault();
            event.returnValue = "Music is playing. Are you sure you want to leave?";
        }
    });
    </script>
    